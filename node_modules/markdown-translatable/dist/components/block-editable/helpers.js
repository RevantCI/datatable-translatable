"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.filter = exports.htmlToMarkdown = exports.markdownToHtml = void 0;

var _showdown = _interopRequireDefault(require("showdown"));

var _turndown = _interopRequireDefault(require("turndown"));

var _turndownPluginGfm = require("turndown-plugin-gfm");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest(); }

function _nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance"); }

function _iterableToArrayLimit(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"] != null) _i["return"](); } finally { if (_d) throw _e; } } return _arr; }

function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }

var turndownService = new _turndown.default({
  headingStyle: 'atx'
});
turndownService.use(_turndownPluginGfm.gfm);
turndownService.addRule('strikethrough', {
  filter: ['del', 's', 'strike'],
  replacement: function replacement(content) {
    return "~".concat(content, "~");
  }
});
turndownService.addRule('underline', {
  filter: ['u'],
  replacement: function replacement(content) {
    return "__".concat(content, "__");
  }
});
turndownService.addRule('emphasis', {
  filter: ['em'],
  replacement: function replacement(content) {
    return "*".concat(content, "*");
  }
});
var markdownToHtmlConverter = new _showdown.default.Converter();
markdownToHtmlConverter.setOption('underline', true);

var markdownToHtml = function markdownToHtml(_ref) {
  var markdown = _ref.markdown,
      _ref$inputFilters = _ref.inputFilters,
      inputFilters = _ref$inputFilters === void 0 ? [] : _ref$inputFilters;

  var _markdown = markdown.slice(0);

  _markdown = filter({
    string: _markdown,
    filters: inputFilters
  });
  var html = markdownToHtmlConverter.makeHtml(_markdown);
  return html;
};

exports.markdownToHtml = markdownToHtml;

var htmlToMarkdown = function htmlToMarkdown(_ref2) {
  var html = _ref2.html,
      _ref2$outputFilters = _ref2.outputFilters,
      outputFilters = _ref2$outputFilters === void 0 ? [] : _ref2$outputFilters;
  var markdown = turndownService.turndown(html);
  markdown = filter({
    string: markdown,
    filters: outputFilters
  });
  return markdown;
};

exports.htmlToMarkdown = htmlToMarkdown;

var filter = function filter(_ref3) {
  var string = _ref3.string,
      filters = _ref3.filters;

  var _string = string.slice(0);

  filters.forEach(function (filter) {
    var _filter = _slicedToArray(filter, 2),
        replacee = _filter[0],
        replacer = _filter[1];

    _string = _string.replace(replacee, replacer);
  });
  return _string;
};

exports.filter = filter;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb21wb25lbnRzL2Jsb2NrLWVkaXRhYmxlL2hlbHBlcnMuanMiXSwibmFtZXMiOlsidHVybmRvd25TZXJ2aWNlIiwiVHVybmRvd25TZXJ2aWNlIiwiaGVhZGluZ1N0eWxlIiwidXNlIiwiZ2ZtIiwiYWRkUnVsZSIsImZpbHRlciIsInJlcGxhY2VtZW50IiwiY29udGVudCIsIm1hcmtkb3duVG9IdG1sQ29udmVydGVyIiwic2hvd2Rvd24iLCJDb252ZXJ0ZXIiLCJzZXRPcHRpb24iLCJtYXJrZG93blRvSHRtbCIsIm1hcmtkb3duIiwiaW5wdXRGaWx0ZXJzIiwiX21hcmtkb3duIiwic2xpY2UiLCJzdHJpbmciLCJmaWx0ZXJzIiwiaHRtbCIsIm1ha2VIdG1sIiwiaHRtbFRvTWFya2Rvd24iLCJvdXRwdXRGaWx0ZXJzIiwidHVybmRvd24iLCJfc3RyaW5nIiwiZm9yRWFjaCIsInJlcGxhY2VlIiwicmVwbGFjZXIiLCJyZXBsYWNlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7Ozs7Ozs7Ozs7OztBQUdBLElBQU1BLGVBQWUsR0FBRyxJQUFJQyxpQkFBSixDQUFvQjtBQUFDQyxFQUFBQSxZQUFZLEVBQUU7QUFBZixDQUFwQixDQUF4QjtBQUNBRixlQUFlLENBQUNHLEdBQWhCLENBQW9CQyxzQkFBcEI7QUFDQUosZUFBZSxDQUFDSyxPQUFoQixDQUF3QixlQUF4QixFQUF5QztBQUN2Q0MsRUFBQUEsTUFBTSxFQUFFLENBQUMsS0FBRCxFQUFRLEdBQVIsRUFBYSxRQUFiLENBRCtCO0FBRXZDQyxFQUFBQSxXQUFXLEVBQUUscUJBQUNDLE9BQUQ7QUFBQSxzQkFBaUJBLE9BQWpCO0FBQUE7QUFGMEIsQ0FBekM7QUFJQVIsZUFBZSxDQUFDSyxPQUFoQixDQUF3QixXQUF4QixFQUFxQztBQUNuQ0MsRUFBQUEsTUFBTSxFQUFFLENBQUMsR0FBRCxDQUQyQjtBQUVuQ0MsRUFBQUEsV0FBVyxFQUFFLHFCQUFDQyxPQUFEO0FBQUEsdUJBQWtCQSxPQUFsQjtBQUFBO0FBRnNCLENBQXJDO0FBSUFSLGVBQWUsQ0FBQ0ssT0FBaEIsQ0FBd0IsVUFBeEIsRUFBb0M7QUFDbENDLEVBQUFBLE1BQU0sRUFBRSxDQUFDLElBQUQsQ0FEMEI7QUFFbENDLEVBQUFBLFdBQVcsRUFBRSxxQkFBQ0MsT0FBRDtBQUFBLHNCQUFpQkEsT0FBakI7QUFBQTtBQUZxQixDQUFwQztBQUtBLElBQU1DLHVCQUF1QixHQUFHLElBQUlDLGtCQUFTQyxTQUFiLEVBQWhDO0FBQ0FGLHVCQUF1QixDQUFDRyxTQUF4QixDQUFrQyxXQUFsQyxFQUErQyxJQUEvQzs7QUFFTyxJQUFNQyxjQUFjLEdBQUcsU0FBakJBLGNBQWlCLE9BQWlDO0FBQUEsTUFBL0JDLFFBQStCLFFBQS9CQSxRQUErQjtBQUFBLCtCQUFyQkMsWUFBcUI7QUFBQSxNQUFyQkEsWUFBcUIsa0NBQVIsRUFBUTs7QUFDN0QsTUFBSUMsU0FBUyxHQUFHRixRQUFRLENBQUNHLEtBQVQsQ0FBZSxDQUFmLENBQWhCOztBQUNBRCxFQUFBQSxTQUFTLEdBQUdWLE1BQU0sQ0FBQztBQUFDWSxJQUFBQSxNQUFNLEVBQUVGLFNBQVQ7QUFBb0JHLElBQUFBLE9BQU8sRUFBRUo7QUFBN0IsR0FBRCxDQUFsQjtBQUNBLE1BQU1LLElBQUksR0FBR1gsdUJBQXVCLENBQUNZLFFBQXhCLENBQWlDTCxTQUFqQyxDQUFiO0FBQ0EsU0FBT0ksSUFBUDtBQUNELENBTE07Ozs7QUFPQSxJQUFNRSxjQUFjLEdBQUcsU0FBakJBLGNBQWlCLFFBQThCO0FBQUEsTUFBNUJGLElBQTRCLFNBQTVCQSxJQUE0QjtBQUFBLGtDQUF0QkcsYUFBc0I7QUFBQSxNQUF0QkEsYUFBc0Isb0NBQVIsRUFBUTtBQUMxRCxNQUFJVCxRQUFRLEdBQUdkLGVBQWUsQ0FBQ3dCLFFBQWhCLENBQXlCSixJQUF6QixDQUFmO0FBQ0FOLEVBQUFBLFFBQVEsR0FBR1IsTUFBTSxDQUFDO0FBQUNZLElBQUFBLE1BQU0sRUFBRUosUUFBVDtBQUFtQkssSUFBQUEsT0FBTyxFQUFFSTtBQUE1QixHQUFELENBQWpCO0FBQ0EsU0FBT1QsUUFBUDtBQUNELENBSk07Ozs7QUFNQSxJQUFNUixNQUFNLEdBQUcsU0FBVEEsTUFBUyxRQUF1QjtBQUFBLE1BQXJCWSxNQUFxQixTQUFyQkEsTUFBcUI7QUFBQSxNQUFiQyxPQUFhLFNBQWJBLE9BQWE7O0FBQzNDLE1BQUlNLE9BQU8sR0FBR1AsTUFBTSxDQUFDRCxLQUFQLENBQWEsQ0FBYixDQUFkOztBQUNBRSxFQUFBQSxPQUFPLENBQUNPLE9BQVIsQ0FBZ0IsVUFBQ3BCLE1BQUQsRUFBWTtBQUFBLGlDQUNHQSxNQURIO0FBQUEsUUFDbkJxQixRQURtQjtBQUFBLFFBQ1RDLFFBRFM7O0FBRTFCSCxJQUFBQSxPQUFPLEdBQUdBLE9BQU8sQ0FBQ0ksT0FBUixDQUFnQkYsUUFBaEIsRUFBMEJDLFFBQTFCLENBQVY7QUFDRCxHQUhEO0FBSUEsU0FBT0gsT0FBUDtBQUNELENBUE0iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgc2hvd2Rvd24gZnJvbSAnc2hvd2Rvd24nO1xuaW1wb3J0IFR1cm5kb3duU2VydmljZSBmcm9tICd0dXJuZG93bic7XG5pbXBvcnQge2dmbX0gZnJvbSAndHVybmRvd24tcGx1Z2luLWdmbSc7XG5cblxuY29uc3QgdHVybmRvd25TZXJ2aWNlID0gbmV3IFR1cm5kb3duU2VydmljZSh7aGVhZGluZ1N0eWxlOiAnYXR4J30pO1xudHVybmRvd25TZXJ2aWNlLnVzZShnZm0pO1xudHVybmRvd25TZXJ2aWNlLmFkZFJ1bGUoJ3N0cmlrZXRocm91Z2gnLCB7XG4gIGZpbHRlcjogWydkZWwnLCAncycsICdzdHJpa2UnXSxcbiAgcmVwbGFjZW1lbnQ6IChjb250ZW50KSA9PiBgfiR7Y29udGVudH1+YCxcbn0pO1xudHVybmRvd25TZXJ2aWNlLmFkZFJ1bGUoJ3VuZGVybGluZScsIHtcbiAgZmlsdGVyOiBbJ3UnXSxcbiAgcmVwbGFjZW1lbnQ6IChjb250ZW50KSA9PiBgX18ke2NvbnRlbnR9X19gLFxufSk7XG50dXJuZG93blNlcnZpY2UuYWRkUnVsZSgnZW1waGFzaXMnLCB7XG4gIGZpbHRlcjogWydlbSddLFxuICByZXBsYWNlbWVudDogKGNvbnRlbnQpID0+IGAqJHtjb250ZW50fSpgLFxufSk7XG5cbmNvbnN0IG1hcmtkb3duVG9IdG1sQ29udmVydGVyID0gbmV3IHNob3dkb3duLkNvbnZlcnRlcigpO1xubWFya2Rvd25Ub0h0bWxDb252ZXJ0ZXIuc2V0T3B0aW9uKCd1bmRlcmxpbmUnLCB0cnVlKTtcblxuZXhwb3J0IGNvbnN0IG1hcmtkb3duVG9IdG1sID0gKHttYXJrZG93biwgaW5wdXRGaWx0ZXJzPVtdfSkgPT4ge1xuICBsZXQgX21hcmtkb3duID0gbWFya2Rvd24uc2xpY2UoMCk7XG4gIF9tYXJrZG93biA9IGZpbHRlcih7c3RyaW5nOiBfbWFya2Rvd24sIGZpbHRlcnM6IGlucHV0RmlsdGVyc30pO1xuICBjb25zdCBodG1sID0gbWFya2Rvd25Ub0h0bWxDb252ZXJ0ZXIubWFrZUh0bWwoX21hcmtkb3duKTtcbiAgcmV0dXJuIGh0bWw7XG59O1xuXG5leHBvcnQgY29uc3QgaHRtbFRvTWFya2Rvd24gPSAoe2h0bWwsIG91dHB1dEZpbHRlcnM9W119KSA9PiB7XG4gIGxldCBtYXJrZG93biA9IHR1cm5kb3duU2VydmljZS50dXJuZG93bihodG1sKTtcbiAgbWFya2Rvd24gPSBmaWx0ZXIoe3N0cmluZzogbWFya2Rvd24sIGZpbHRlcnM6IG91dHB1dEZpbHRlcnN9KTtcbiAgcmV0dXJuIG1hcmtkb3duO1xufTtcblxuZXhwb3J0IGNvbnN0IGZpbHRlciA9ICh7c3RyaW5nLCBmaWx0ZXJzfSkgPT4ge1xuICBsZXQgX3N0cmluZyA9IHN0cmluZy5zbGljZSgwKTtcbiAgZmlsdGVycy5mb3JFYWNoKChmaWx0ZXIpID0+IHtcbiAgICBjb25zdCBbcmVwbGFjZWUsIHJlcGxhY2VyXSA9IGZpbHRlcjtcbiAgICBfc3RyaW5nID0gX3N0cmluZy5yZXBsYWNlKHJlcGxhY2VlLCByZXBsYWNlcik7XG4gIH0pO1xuICByZXR1cm4gX3N0cmluZztcbn07XG4iXX0=